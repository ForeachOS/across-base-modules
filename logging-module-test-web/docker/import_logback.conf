input {
    tcp {
        port => 5010
        codec => "json_lines"
        add_field => {
            "logback_env" => "prod"
            "logback" => "true"
        }
    }
}

filter {
    if [logback] == "true" {
        if [appender] == "methods" {
            grok {
                "match" => {
                    "message" => "^%{NUMBER:depth}	%{DATA:method}	%{NUMBER:duration}$"
                }
            }
        }
        if [appender] == "requests" {
            grok {
                "match" => {
                    "message" => "^%{DATA:remoteAddress}	%{DATA:method}	%{DATA:url}	%{DATA:servletPath}	%{DATA:requestMapping}	%{DATA:handlerName}	%{DATA:viewName}	%{NUMBER:status}	%{NUMBER:duration}$"
                }
            }
        }
        if [appender] == "hikari" {
            grok {
                "match" => {
                    "message" => "^%{DATA:pool} - %{DATA:location} cleanup%{SPACE}stats \(total=%{NUMBER:total}, active=%{NUMBER:active}, idle=%{NUMBER:idle}, waiting=%{NUMBER:waiting}\)$"
                }
            }
        }
    }
}

output {
    if [logback] == "true" {
          elasticsearch {
            hosts => ["https://f0832b0eb9b4422f86928c11c0c714cf.eu-west-1.aws.found.io:9243/"]
            index => "%{logback_env}-logs-%{application}-%{appender}_%{+YYYY.MM.dd}"
            user => "elastic"
            password => "nGHl25FUs5BJBc8zeSbszRTI"
            document_type => "log"
          }
    }
}